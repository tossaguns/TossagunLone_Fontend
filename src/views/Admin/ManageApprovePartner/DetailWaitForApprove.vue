<template>
  <TemplateAdmin>
    <template #header>
      <label>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏û‡∏≤‡∏£‡πå‡∏ó‡πÄ‡∏ô‡∏≠‡∏£‡πå</label>
    </template>
    <template #content>
      <div class="p-4 max-w-[3000px] mx-auto">

        <h2 class="text-xl font-bold mb-8 text-center">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó {{ companyName }}</h2>

        <div class="flex md:justify-end justify-center space-x-3 mr-4 mb-2 items-center">
          <p class="block text-sm text-stone-400">‡∏•‡∏≥‡∏î‡∏±‡∏ö</p>
          <p class="text-xl bg-green-100 px-4 py-1 rounded-full shadow-md">{{ index }}</p>
        </div>



        <hr class="border-2 mb-6 " />


        <div class="mb-4">
          <div class="flex">
            <p class="font-bold">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å :</p>
            <p class="bg-rose-200 rounded-md shadow-lg ml-4">
              <template v-if="partner.hotelType && partner.hotelType.name">
                <p class=" px-4 py-1">{{ partner.hotelType.name }}</p>
              </template>
              <template v-else>
                <span class="text-red-500 bg-white px-4 py-2 rounded-md">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å</span>
              </template>
            </p>
          </div>


          <div class="flex space-x-4 mt-5">
            <p class="font-bold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ :</p>
            <div :class="{
              'bg-green-500': status === 'approved',
              'bg-red-500': status === 'rejected',
              'bg-amber-500': status === 'edit-requested',
              'bg-gray-200': status !== 'approved' && status !== 'rejected' && status !== 'edit-requested'

            }" class="rounded-md shadow-lg">
              <p :class="{
                'text-green-800': status === 'approved',
                'text-red-50': status === 'rejected',
                'text-amber-50': status === 'edit-requested',
                'text-gray-700': status !== 'approved' && status !== 'rejected' && status !== 'edit-requested'
              }" class="px-4 py-1">
                {{ status }}
              </p>
            </div>
          </div>
        </div>

        <hr class="border-2 mb-6 " />

        <div class="mb-4 ">
          <p class="text-green-600">1. ‡∏£‡∏π‡∏õ‡πÄ‡πÄ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PDF</p>
        </div>

        <div class="flex justify-center">
          <!-- ‡∏£‡∏π‡∏õ‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô -->
          <div class="max-w-7xl flex flex-col md:flex-row md:gap-2 xl:gap-4 justify-center">
            <div class="mt-4">
              <p class="block text-sm font-medium mb-2 text-center">‡∏£‡∏π‡∏õ‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</p>
              <div
                class="w-32 h-32 border rounded flex items-center justify-center overflow-hidden bg-gray-50 cursor-pointer"
                @click="partner.imageIden && openImageModal(partner.imageIden)">
                <img v-if="partner.imageIden" :src="partner.imageIden" class="w-full h-full object-cover"
                  alt="‡∏£‡∏π‡∏õ‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô" />
                <span v-else class="text-xs text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</span>
              </div>
            </div>

            <!-- ‡∏£‡∏π‡∏õ‡∏ß‡∏µ‡∏ã‡πà‡∏≤ -->
            <div class="mt-4">
              <p class="block text-sm font-medium mb-2 text-center">‡∏£‡∏π‡∏õ‡∏ß‡∏µ‡∏ã‡πà‡∏≤</p>
              <div
                class="w-32 h-32 border rounded flex items-center justify-center overflow-hidden bg-gray-50 cursor-pointer"
                @click="partner.imageVisa && openImageModal(partner.imageVisa)">
                <img v-if="partner.imageVisa" :src="partner.imageVisa" class="w-full h-full object-cover"
                  alt="‡∏£‡∏π‡∏õ‡∏ß‡∏µ‡∏ã‡πà‡∏≤" />
                <span v-else class="text-xs text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</span>
              </div>
            </div>

            <!-- ‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ô‡∏≠‡∏Å -->
            <div class="mt-4">
              <p class="block text-sm font-medium mb-2 text-center">‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å‡∏î‡πâ‡∏≤‡∏ô‡∏ô‡∏≠‡∏Å</p>
              <div
                class="w-32 h-32 border rounded flex items-center justify-center overflow-hidden bg-gray-50 cursor-pointer"
                @click="partner.imageHotelOurDoor && openImageModal(partner.imageHotelOurDoor)">
                <img v-if="partner.imageHotelOurDoor || partner.imagehotelOurdoor"
                  :src="partner.imageHotelOurDoor || partner.imagehotelOurdoor" class="w-full h-full object-cover"
                  alt="‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ô‡∏≠‡∏Å" />
                <span v-else class="text-xs text-gray-400">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ</span>
              </div>
            </div>

            <!-- ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï (PDF) -->
            <div class="mt-4">
              <p class="block text-sm font-medium mb-2 text-center">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï (PDF)</p>
              <div v-if="partner.businessLicense">
                <a :href="partner.businessLicense" target="_blank" rel="noopener noreferrer"
                  class="inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                  ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï
                </a>
              </div>
              <span v-else class="text-xs text-gray-400 ">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï</span>
            </div>

            <!-- Modal ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà -->
            <div v-if="showImage" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50"
              @click.self="closeImageModal">
              <img :src="modalImageSrc" alt="‡∏£‡∏π‡∏õ‡∏Ç‡∏¢‡∏≤‡∏¢" class="max-w-3xl max-h-[90vh] rounded shadow-lg" />
              <button @click="closeImageModal"
                class="absolute top-5 right-5 text-white text-3xl font-bold cursor-pointer"
                aria-label="Close modal">&times;</button>
            </div>
          </div>
        </div>

        <hr class="border my-6" />

        <div class="mb-4 ">
          <p class="text-amber-600">2. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</p>
        </div>

        <div class="flex flex-col md:flex-row justify-between items-start gap-6 pb-4">
          <!-- ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó -->
          <div class="md:w-1/2 w-full xl:ml-20">
            <div class="mb-3 w-full">
              <p class="block text-sm font-medium mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</p>
              <p v-if="partner" class="border rounded-md py-1 px-3 border-stone-300">{{ partner.companyName }}</p>
            </div>

            <div class="mb-3">
              <p class="block text-sm font-medium mb-1">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</p>
              <p v-if="partner" class="border rounded-md py-1 px-3 border-stone-300">{{ partner.companyAddress ||
                partner.address }}</p>
            </div>

            <div class="mb-3">
              <p class="block text-sm font-medium mb-1">‡∏ï‡∏≥‡∏ö‡∏•</p>
              <p v-if="partner" class="border rounded-md py-1 px-3 border-stone-300">{{ partner.companySubdistrict ||
                partner.subdistrict }}</p>
            </div>

            <div class="mb-3">
              <p class="block text-sm font-medium mb-1">‡∏≠‡∏≥‡πÄ‡∏†‡∏≠</p>
              <p v-if="partner" class="border rounded-md py-1 px-3 border-stone-300">{{ partner.companyDistrict ||
                partner.district }}</p>
            </div>

            <div class="mb-3">
              <p class="block text-sm font-medium mb-1">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</p>
              <p v-if="partner" class="border rounded-md py-1 px-3 border-stone-300">{{ partner.companyProvince ||
                partner.province }}</p>
            </div>

            <div class="mb-3">
              <p class="block text-sm font-medium mb-1">‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå</p>
              <p v-if="partner" class="border rounded-md py-1 px-3 border-stone-300">{{ partner.companyPostcode ||
                partner.postcode }}</p>
            </div>
          </div>

          <!-- ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà -->
          <div class="md:w-1/2 w-full xl:mr-20">
            <p class="block text-sm font-medium mb-2">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</p>
            <iframe v-if="partner.hotelLatitude && partner.hotelLongitude"
              :src="`https://www.google.com/maps/embed/v1/place?key=YOUR_GOOGLE_MAPS_API_KEY&q=${partner.hotelLatitude},${partner.hotelLongitude}`"
              width="100%" height="400" style="border:0;" allowfullscreen="" loading="lazy"
              referrerpolicy="no-referrer-when-downgrade" class="rounded-lg shadow">
            </iframe>
            <div class="flex space-x-3 text-xs justify-center mt-2">
              <p v-if="partner">Latitude : {{ partner.hotelLatitude }}</p>
              <p v-if="partner">Longitude : {{ partner.hotelLongitude }}</p>
            </div>
          </div>
        </div>

        <hr class="border-1 my-6" />

        <div class="mb-4 ">
          <p class="text-red-600">3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</p>
        </div>

        <div class="flex flex-col justify-center items-center max-w-4xl mx-auto pb-4">
          <div class="w-full">
            <div class="mt-3">
              <p class="block text-sm font-medium mb-1">‡∏ä‡∏∑‡πà‡∏≠</p>
              <p v-if="partner" class="border rounded-md py-1 px-3 border-stone-300">{{
                partner.firstname }}</p>
            </div>

            <div class="mt-3">
              <p class="block text-sm font-medium mb-1">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</p>
              <p v-if="partner" class="border rounded-md py-1 px-3 border-stone-300">{{
                partner.lastname }}</p>
            </div>

            <div class="mt-3">
              <p class="block text-sm font-medium mb-1">‡πÄ‡∏û‡∏®</p>
              <p v-if="partner" class="border rounded-md py-1 px-3 border-stone-300">{{
                partner.sex }}</p>
            </div>

            <div class="mt-3">
              <p class="block text-sm font-medium mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</p>
              <p v-if="partner" class="border rounded-md py-1 px-3 border-stone-300">{{
                partner.phone }}</p>
            </div>

            <div class="mt-3">
              <p class="block text-sm font-medium mb-1">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</p>
              <p v-if="partner" class="border rounded-md py-1 px-3 border-stone-300">{{
                partner.email }}</p>
            </div>

            <div class="mt-3">
              <p class="block text-sm font-medium mb-1">‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô</p>
              <p v-if="partner" class="border rounded-md py-1 px-3 border-stone-300">{{
                partner.idenNumber }}</p>
            </div>
          </div>
        </div>

        <hr class="border-1 my-6" />


        <div class="flex flex-col text-stone-500 text-sm">
          <div class="flex  space-x-3">
            <p class="block font-medium">‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡πà‡∏ô‡∏™‡∏°‡∏±‡∏Ñ‡∏£ :</p>
            <p v-if="partner">{{ partner.createdAt }}</p>
          </div>
        </div>


        <hr class="border-2 my-6" />


        <div class="flex justify-center space-x-3" v-if="partner.status !== 'reject' && partner.status !== 'rejected'">
          <button @click="approvePartner"
            class="bg-green-500 py-2 px-4 rounded-lg text-white font-bold hover:bg-green-600">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>

          <button @click="requestEditPartner"
            class="bg-yellow-400 py-2 px-4 rounded-lg text-white font-bold hover:bg-yellow-500">‡πÄ‡πÄ‡∏Å‡πâ‡πÑ‡∏Ç</button>

          <button @click="rejectPartner"
            class="bg-red-500 py-2 px-4 rounded-lg text-white font-bold hover:bg-red-600">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
        </div>
      </div>



      <div @click="navigateBack" class="flex justify-center my-6">
        <button class="bg-red-500 p-2 rounded-lg hover:bg-red-600 text-white ">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
      </div>

    </template>
  </TemplateAdmin>
</template>

<script setup>

import TemplateAdmin from "@/components/TemplateAdmin.vue";
import { ref, computed, onMounted, watch } from 'vue'
import { useRouter, useRoute } from 'vue-router'
import axios from 'axios'


const partner = ref({})
const index = ref(null)
const status = ref('-')
const showImage = ref(false)
const modalImageSrc = ref(null)

// router
const route = useRoute()
const router = useRouter()

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏î‡∏π‡∏£‡∏π‡∏õ
function openImageModal(imageUrl) {
  modalImageSrc.value = imageUrl
  showImage.value = true
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î modal ‡∏£‡∏π‡∏õ
function closeImageModal() {
  showImage.value = false
  modalImageSrc.value = null
}



// ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏¥‡∏°
function navigateBack() {
  router.go(-1)
}

// ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ partner
async function approvePartner() {
  try {
    await axios.put(`http://localhost:9999/HotelSleepGun/partner/approve/${partner.value._id}`)
    alert("‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")
    router.push("/admin/partnerlist")
  } catch (err) {
    console.error("‚ùå Error approving partner:", err)
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥")
  }
}

// ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò partner
async function rejectPartner() {
  const reason = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥:")
  if (!reason) return

  try {
    await axios.put(`http://localhost:9999/HotelSleepGun/partner/reject/${partner.value._id}`, { reason })
    alert("‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")
    router.push("/admin/partnerlist")
  } catch (err) {
    console.error("‚ùå Error rejecting partner:", err)
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò")
  }
}

// ‡∏Ç‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç partner
async function requestEditPartner() {
  const reason = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:")
  if (!reason) return

  try {
    await axios.post(`http://localhost:9999/HotelSleepGun/partner/request-edit/${partner.value._id}`, { reason })
    alert("üì© ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")
    router.push("/admin/partnerlist")
  } catch (err) {
    console.error("‚ùå Error requesting edit:", err)
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")
  }
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
onMounted(() => {

  index.value = route.query.index || null
  status.value = route.query.status || '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥'

  const partnerId = route.params.id
  if (partnerId) {
    axios.get(`http://localhost:9999/HotelSleepGun/partner/get/${partnerId}`)
      .then(res => {
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ res.data.partner ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡πá‡πÉ‡∏ä‡πâ res.data ‡πÄ‡∏î‡∏¥‡∏°
        partner.value = res.data.partner ? res.data.partner : res.data
        console.log('‚úÖ response.data:', res.data)
      })
      .catch(err => {
        console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• partner:', err)
      })
  } else {
    console.error('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö ID ‡πÉ‡∏ô route params')
  }
})

</script>
<style></style>
